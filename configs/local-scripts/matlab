#!/usr/bin/env nu

def main [...rest] {
    let matlab_apps = (ls /Applications | where name =~ "MATLAB_R" | sort-by name)

    if ($matlab_apps | is-empty) {
        error make {msg: "No MATLAB installation found in /Applications."}
    }

    if ($matlab_apps | length) > 1 {
        print -e "Warning: Multiple MATLAB installations found. Using the latest one."
    }

    let latest_matlab = ($matlab_apps | last | get name | path basename)
    let matlab_path = $"/Applications/($latest_matlab)/bin/matlab"

    if not ($matlab_path | path exists) {
        error make {msg: $"MATLAB executable not found at ($matlab_path)"}
    }

    ^$matlab_path ...$rest
}