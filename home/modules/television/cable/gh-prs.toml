[metadata]
name = "gh-prs"
description = "List GitHub PRs for the current repo"
requirements = ["gh", "nu"]

[source]
command = '''nu -c 'gh pr list --state open --limit 100 --json number,title,headRefName,author | from json | each {|pr| [$pr.number, $pr.title, $pr.headRefName, $pr.author.login] | str join "|"} | str join (char newline)' '''
output = "{split:|:0}"

[ui]
header = "number | title | branch | author"

[preview]
command = "gh pr view '{split:|:0}'"

[keybindings]
enter = "actions:view"
ctrl-o = "actions:open"
ctrl-a = "actions:approve"
ctrl-m = "actions:merge"

[actions.view]
description = "View PR details"
command = "gh pr view '{split:|:0}'"
mode = "fork"

[actions.open]
description = "Open in browser"
command = "gh pr view '{split:|:0}' --web"
mode = "fork"

[actions.approve]
description = "Approve PR"
command = "gh pr review '{split:|:0}' --approve"
mode = "fork"

[actions.merge]
description = "Enable auto-merge"
command = "gh pr merge '{split:|:0}' --auto"
mode = "fork"
